# 关于 CHARSET 和 COLLATE

[再见乱码：5分钟读懂MySQL字符集设置 - 程序猿小卡 - 博客园](https://www.cnblogs.com/chyingp/p/mysql-character-set-collation.html)

[MYSQL中的COLLATE是什么？ - 腾讯云开发者 - 博客园](https://www.cnblogs.com/qcloud1001/p/10033364.html)



UTF-8（UTF-8MB3）与UTF-8MB4的基本区别

- **UTF-8（也称为UTF-8MB3）**：这是MySQL中的一种字符集，它支持最长为三个字节的字符。这意味着它可以存储基本多语言平面（BMP）中的字符，但不支持四字节的Unicode字符，如某些罕见的汉字、表情符号或新加入Unicode的字符。
- **UTF-8MB4**：这是UTF-8的超集，它支持最长为四个字节的字符。这使得它能够存储所有Unicode字符，包括BMP之外的字符和表情符号等。从MySQL 5.5.3版本开始支持UTF-8MB4。



# MySQL的默认库



MySQL默认的四个系统库及其作用如下：

---

### **1. `information_schema`**
- **作用**：存储数据库的**元数据**信息，提供对数据库结构的只读访问。
- **关键内容**：
  - 数据库、表、列、索引、权限等元数据（如`TABLES`、`COLUMNS`、`SCHEMATA`表）。
  - 视图、存储过程、触发器等对象信息。
- **特点**：
  - 数据通过**视图**动态生成，不直接存储数据。
  - 用户不可修改，用于查询数据库结构（如`SHOW`命令的底层实现）。

---

### **2. `mysql`**
- **作用**：存储**用户账户、权限、系统配置**及核心数据。
- **关键内容**：
  - 用户与权限表（如`user`、`db`、`tables_priv`）。
  - 存储过程、事件、触发器定义。
  - 时区配置、日志配置（如`time_zone`、`general_log`）。
- **特点**：
  - 直接修改可能导致系统不稳定，建议使用`GRANT`、`ALTER USER`等SQL语句管理。
  - 包含关键系统数据（如`root`用户密码）。

---

### **3. `performance_schema`**
- **作用**：收集MySQL服务器的**运行时性能数据**，用于监控与分析。
- **关键内容**：
  - 资源使用情况（CPU、内存、I/O）。
  - 查询执行细节、锁竞争、连接信息。
  - 事件监控（如`events_statements_summary_by_digest`）。
- **特点**：
  - 数据基于配置项动态采集，默认部分功能开启。
  - 用于深度性能调优，表结构复杂，需结合文档使用。

---

### **4. `sys`**
- **作用**：提供**简化视图与工具**，辅助性能分析与诊断。
- **关键内容**：
  - 基于`information_schema`和`performance_schema`的预定义视图（如`schema_table_statistics`）。
  - 常用性能指标汇总（如高负载查询、索引使用情况）。
- **特点**：
  - 专为DBA设计，简化复杂性能查询（如`sys.session`视图）。
  - 无独立数据，依赖底层系统库，MySQL 5.7+版本默认集成。

---

### **注意事项**
- **版本差异**：`sys`库在MySQL 5.7及以上版本默认存在，旧版本需手动安装。
- **安全操作**：避免直接修改系统库表（如`mysql.user`），优先使用专用SQL语句。
- **性能开销**：`performance_schema`可能占用资源，可按需配置监控项。

通过这四个库，MySQL实现了元数据管理、权限控制、性能监控与优化支持的核心功能。



# 关于锁

mysql官方文档对锁的详细解释。

[MySQL :: MySQL 8.4 Reference Manual :: 17.7.1 InnoDB Locking](https://dev.mysql.com/doc/refman/8.4/en/innodb-locking.html)



一些文档

[MySQL锁、加锁机制（超详细）—— 锁分类、全局锁、共享锁、排他锁；表锁、元数据锁、意向锁；行锁、间隙锁、临键锁；乐观锁、悲观锁-腾讯云开发者社区-腾讯云](https://cloud.tencent.com/developer/article/2431018)





检查数据库事务隔离级别

```mysql
show variables like '%trans%';

---
transaction_isolation,REPEATABLE-READ
---
```

t1

```sql
start transaction ;
select * from customers where customer_number = 103;
commit ; -- 暂不提交 
```

t2

```sql
start transaction ;
update customers set customer_name = 'Atelier graphique6' where customer_number = 103;  这里应该阻塞，因为 t1 持有S锁，确实这样理解没错，但是mysql存在mvcc机制。
commit ; -- t2正常提交
```

