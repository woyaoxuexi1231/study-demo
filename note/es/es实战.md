# 1. 介绍

随着互联网和数据量的迅猛增长，全文搜索和实时分析的需求也在不断上升。Elasticsearch 于 2010 年首次发布，迅速成为处理大规模数据和提供快速搜索能力的首选工具。Elasticsearch 是一个分布式搜索和分析引擎，基于 Apache Lucene 构建。它主要用于处理全文搜索、日志和事件数据分析、实时应用监控和数据分析等场景。

在面对全文检索和实时分析时，传统的关系型数据库在这方面的性能和功能都完全达不到要求。虽然可以通过`LIKE`或`FULLTEXT`索引实现部分检索功能，但效率低下，尤其在面对复杂查询（如模糊匹配、多条件筛选）时。而ES专注于全文检索，支持分词、权重计算（TF-IDF）、高亮、排序等特性。

- **关系型数据库**存储核心业务数据；
- **Elasticsearch**为搜索和分析服务；
- **NoSQL数据库**用于存储非结构化或半结构化数据。



## 1.1 Elasticsearch 提供的特型

### 1.1.1 提供快速匹配

Lucene使用倒排索引，它将创建一个数据结构，并在其中保存记录每个单词出现在哪些数据中的清单。在查找时查询一个包含 xxx 的文档，相对于查找原始数据而言，查找倒排索引会更加快捷，只需要找到 xxx 这一栏的记录，然后就可以在记录中找到所有包含 xxx 的文档 id。

### 1.1.2 确保结果的相关性

如果大量的帖子均包含同一个关键字，那么如何确定真正需要的帖子在最前面呢？

es使用几个算法来计算相关性的得分，然后根据分数来对帖子进行逐个排序，分数高的自然也就排在前面，默认情况下，计算文档的相关性得分的算法是 **TF-IDF**

- 词频 - 所查找的单词在文档中出现的次数越多，得分越高
- 逆文档词频 - 如果某个单词在所有文档中比较少见，那么该词的权重越高，得分也会越高。

### 1.1.3 超越精确匹配

Elasticsearch有些选项可以让搜索变得很直观，而不仅仅是精确匹配用户的输入。当用户录入与已存在的存储词有所不同的错误拼写、同义词或派生词时，这些选项使用起来非常方便。

1. 处理错误的拼写
2. 支持变体(同义词)
3. 使用统计信息
4. 给予自动提示



# 2. 深入功能

## 2.1 文档、类型和索引

### 2.1.1 文档

文档通常是数据的json表示，也就是我们存储的真实数据。

### 2.1.2 类型

类型是文档的逻辑容器，类似于表格是行的容器。其中定义这类文档的数据结构。

每个类型中字段的定义称为映射。例如 name 字段可以映射为 string。

### 2.1.3 索引

索引是映射类型的容器，索引存储了所有映射类型的字段，还有一些设置。

## 2.2 物理设计

### 2.2.1 理解节点和分片

节点：一个节点就是一个Elasticsearch的实例。

分片：一份分片是Lucene的索引：一个包含倒排索引的文件目录。它默认存储原始文档的内容，再加上一些额外的信息。词条字典将每个词条和包含该词条的文档映射起来，搜索的时候，Elasticsearch没有必要为了某个词条扫描所有的文档，而是根据这个字典快速的识别匹配的文档。



