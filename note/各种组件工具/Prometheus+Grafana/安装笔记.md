[一、Prometheus+Grafana普罗米修斯，搭建和使用_普罗米修斯 grafana-CSDN博客](https://blog.csdn.net/qq_31725371/article/details/114697770)





# Prometheus 安装

```
wget https://github.com/prometheus/prometheus/releases/download/v2.25.0/prometheus-2.25.0.linux-amd64.tar.gz

tar xf  prometheus-2.25.0.linux-amd64.tar.gz -C /usr/local

cd /usr/local

# 改个名字
mv prometheus-2.25.0.linux-amd64/ prometheus

# 直接启动 
./prometheus --config.file=prometheus.yml

# 192.168.3.102:9090 
```





# node_exporter 安装

```
wget https://github.com/prometheus/node_exporter/releases/download/v1.1.2/node_exporter-1.1.2.linux-amd64.tar.gz

tar xf node_exporter-1.1.2.linux-amd64.tar.gz -C /usr/local/

cd /user/local

mv node_exporter-1.1.2.linux-amd64/ node_exporter

# 启动 
./node_exporter &
```

安装完成后就需要在 prometheus 中配置监控项

在普罗米修斯的yml文件中添加 

```
# 添加在 scrape_configs: 配置下
  - job_name: 'linux'
    static_configs:
      - targets: [ '192.168.2.44:9100','192.168.2.43:9100' ] # 多个用,分开
```

重启普罗米修斯后

随后在 普罗米修斯 的管路页面中，status 下面就可以看到相关的服务了



# Grafana 安装

```
wget https://dl.grafana.com/enterprise/release/grafana-enterprise-10.0.1-1.x86_64.rpm

yum install initscripts fontconfig
yum install -y grafana-enterprise-10.0.1-1.x86_64.rpm

# 查看状态
systemctl status grafana-server.service

#设置服务开机自启动
systemctl enable grafana-server.service

#启动服务
systemctl start grafana-server.service
```

启动后访问  http://192.168.3.102:3000

默认账户密码  admin/admin



## 添加 Prometheus 数据源

**Configuration -> Data Sources ->add data source -> Prometheus**



Data Source 中直接配置普罗米修斯后就可以了，后续在 dashboard 中配置

模板：

- 8919  linux 服务器监控模板
- 4701 jvm 监控模板



# 配置 Spring Boot 项目监控

配置依赖

```xml
<!-- 普罗米修斯 -->
<dependency>
    <groupId>io.micrometer</groupId>
    <artifactId>micrometer-registry-prometheus</artifactId>
</dependency>
```

配置文件配置暴露端点

```yaml
##################################  暴露端点  ##################################
management:
  endpoints:
    web:
      exposure:
        include: '*'
  endpoint:
    shutdown:
      enabled: true
    # 配置普罗米修斯的端点信息
    prometheus:
      enabled: true
    health:
      show-details: always
  # 指标允许被导出
  metrics:
    export:
      prometheus:
        enabled: true
```

普罗米修斯中配置任务

```yaml
  - job_name: 'springboot_prometheus'
    scrape_interval: 5s
    metrics_path: '/actuator/prometheus'
    scheme: https
    static_configs:
      - targets: ['192.168.3.2:9999']
    tls_config:
      insecure_skip_verify: true
```

在grafana导入 4701 模板，然后创建 dashboard 即可



# 配置 MySQL 监控

要监控 MySQL 其实 grafana 也是通过 Prometheus 来监控，通过获取 Prometheus 提供的数据来生成报告。



下载 mysql_exporter

```
wget https://github.com/prometheus/mysqld_exporter/releases/download/v0.13.0/mysqld_exporter-0.13.0.linux-amd64.tar.gz

tar xvf mysqld_exporter-0.13.0.linux-amd64.tar.gz -C /usr/local/

cd /usr/local/

mv mysqld_exporter-0.13.0.linux-amd64 mysqld_exporter
```

在此文件夹 mysqld_exporter 下创建一个配置文件，这个配置文件将用于连接 mysql 实例，`.my.cnf`

`.my.cnf`

```
[client]
user = root
password = 123456
host = 192.168.3.102
port = 3306
```

后台启动 ./mysqld_exporter --config.my-cnf=.my.cnf &



随后需要在 prometheus 配置新的任务

```yaml
  - job_name: 'mysqld_exporter'
    static_configs:
    - targets: ['192.168.1.102:9104']
      labels:
        app: mysqld_exporter
        node: node1
        role: mysqld_exporter
```

重启prometheus后，在grafana配置7362模板进行监控



# 配置 redis 监控

安装 redis_exporter 

```
wget https://github.com/oliver006/redis_exporter/releases/download/v0.15.0/redis_exporter-v0.15.0.linux-amd64.tar.gz

tar -C /usr/local/ -xvf redis_exporter-v0.15.0.linux-amd64.tar.gz

./redis_exporter -redis.addr 192.168.3.102:6379 -redis.password 123456 &
```



配置 Prometheus 任务 

```yaml
  - job_name: redis_since
    static_configs:
    - targets: ['192.168.3.102:9121']
```



grafana 推荐模板 23254

