## redis和数据库保持一致性

这个问题的前提是 redis作为缓存中间件使用,缓存查询到的数据以便后续使用,而不需要再次访问db,而更新数据库带来的数据更新可能导致缓存与真实数据的不一致

主要从先操作数据库还是先操作缓存说起:

1. 先操作缓存再操作数据库
   先操作缓存(无论是更新还是删除)再更新数据库
   存在的问题是: 1.缓存如果更新失败,那么就会导致两者数据不一致 2.先删除缓存,再更新数据库,在极端情况下,删除缓存和更新缓存不是原子也导致数据不一致
2. 先操作数据库再操作缓存
   存在的问题: 数据库更新成功,但是缓存操作失败

上述问题的解决并不是一成不变的,需要根据具体业务场景来判断

- 最终一致性方案: 1.使用消息中间件在缓存更新失败的情况下进行重试操作 2.使用canal组件监控mysql的binlog日志更新缓存
- 延迟双删-更新数据时先删除一遍redis的数据,再更新数据库,更新完成后延迟一定时间再删除redis的数据
- 强一致性方案: 整个过程加读写锁,更新时其他线程无法访问当前数据
