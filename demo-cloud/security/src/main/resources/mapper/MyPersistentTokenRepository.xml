<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.hundsun.demo.springcloud.security.mapper.MyPersistentTokenRepository">
    <insert id="createNewToken"
            parameterType="org.springframework.security.web.authentication.rememberme.PersistentRememberMeToken">
        insert into security_persistent_logins(username, series, token, last_used) value (#{username}, #{series}, #{tokenValue}, #{date})
    </insert>

    <update id="updateToken">
        update security_persistent_logins
        set token     = #{param2},
            last_used =#{param3}
        where series = #{param1}
    </update>

    <select id="getTokenForSeries">
        select pl.username  as username,
               pl.series    as series,
               pl.token     as tokenValue,
               pl.last_used as date
        from security_persistent_logins pl
        where pl.series = #{seriesId}
    </select>

    <delete id="removeUserTokens">
        delete
        from security_persistent_logins
        where username = #{username}
    </delete>

    <delete id="removeTokenBySeries">
        DELETE
        FROM security_persistent_logins
        WHERE series = #{series}
    </delete>
</mapper>